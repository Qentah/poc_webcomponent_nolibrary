<script src="/components/layout.js" defer></script>
<script src="/components/clock-digital.js" defer></script>
<script src="/components/logic-component.js" defer></script>

<script>
    const badControllerRefs = [];

    function register_click(ref) {
        const { useValue: { value, setValue } } = ref;
        badControllerRefs.push(ref);

        ref.addEventListener('click', () => {
            const val = Math.floor(Math.random() * 100);
            if (val % 2 === 0) {
                ref.setAttribute('variant', 'success');
            } else {
                ref.setAttribute('variant', 'danger');
            }
            setValue(val);
        });
    }

    function register_interval(ref) {
        const { useValue: { value, setValue } } = ref;
        badControllerRefs.push(ref);

        let i = 0;
        setInterval(() => {
            i++;
            setValue(`${i} seconds`);
        }, 1000);
    }

    function register_bad(ref) {
        const { useValue: { value, setValue } } = ref;
        ref.addEventListener('click', () => {
            badControllerRefs.forEach(ref => {
                ref.useValue.setValue('BAD');
            });
        });
    }
</script>

<style>
    clock-digital {
        border-radius: 5px;
    }
</style>

<app>
    <layout-row style="
        justify-content: center;
        gap: 10%;
        ">
        <clock-digital></clock-digital>
        <logic-component variant="warning" value="0" oninit="register_interval(ref)"></logic-component>
        <logic-component value="HEY" oninit="register_click(ref)"></logic-component>
        <logic-component value="Bad Controller" oninit="register_bad(ref)"></logic-component>
    </layout-row>
</app>